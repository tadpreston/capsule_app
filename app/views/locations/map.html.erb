<div id="map-canvas"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js">
</script>
<script type="text/javascript">
var locations = <%= raw @locations.to_json.html_safe %>;
$(document).ready(function(){
	initialize();
});

function initialize() {
	var myLatlng = new google.maps.LatLng(locations[0].latitude, locations[0].longitude);
	var mapOptions = {
		center: myLatlng,
		zoom: 8,
		panControl: false,
		zoomControl: true,
		zoomControlOptions: {
			style: google.maps.ZoomControlStyle.SMALL,
			position: google.maps.ControlPosition.RIGHT_TOP
		},
		mapTypeControl: false,
		scaleControl: false,
		streetViewControl: false,
		overviewMapControl: false
	};
	
	var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

	locations.forEach(function(location){
		var thisLatLng = new google.maps.LatLng(location.latitude, location.longitude);
		var marker = new google.maps.Marker({
			position: thisLatLng,
			map: map,
			title:location.name,
			icon: '<%= asset_url "yada_map_pin.png" %>'
		});
		var infowindow = new google.maps.InfoWindow({
			content: location.name
		});
		google.maps.event.addListener(marker, 'click', function() {
			infowindow.open(map,marker);
		});
	});

	// Create the DIV to hold the control and call the HomeControl() constructor
	// passing in this DIV.
	var locationCountControlDiv = document.createElement('div');
	var locationControl = new locationCountControl(locationCountControlDiv, map);

	locationControl.index = 1;
	map.controls[google.maps.ControlPosition.TOP_LEFT].push(locationCountControlDiv);
}

function locationCountControl(controlDiv, map) {

	// Set CSS styles for the DIV containing the control
	// Setting padding to 5 px will offset the control
	// from the edge of the map.
	controlDiv.style.padding = '5px';

	// Set CSS for the control border.
	var controlUI = document.createElement('div');
	controlUI.style.backgroundColor = 'white';
	controlUI.style.borderStyle = 'solid';
	controlUI.style.borderWidth = '2px';
	//controlUI.style.cursor = 'pointer';
	controlUI.style.textAlign = 'center';
	//controlUI.title = 'Click to set the map to Home';
	controlDiv.appendChild(controlUI);

	// Set CSS for the control interior.
	var controlText = document.createElement('div');
	controlText.style.fontFamily = 'Arial,sans-serif';
	controlText.style.fontSize = '12px';
	controlText.style.paddingLeft = '4px';
	controlText.style.paddingRight = '4px';
	controlText.innerHTML = '<strong> Total # of location Yadas pinned: <b>' + locations.length + '</b></strong>';
	controlUI.appendChild(controlText);

	// Setup the click event listeners: simply set the map to Chicago.
	google.maps.event.addDomListener(controlUI, 'click', function() {
		map.setCenter(chicago)
	});
}

</script>